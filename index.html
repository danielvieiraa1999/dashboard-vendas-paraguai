<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCe-e8rB5b3JRxzsMnAid3l2MOLDI4Ym9A",
  authDomain: "dashboard-vendas-paraguai.firebaseapp.com",
  projectId: "dashboard-vendas-paraguai"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ðŸ”¹ PEGAR ELEMENTOS CORRETAMENTE
const btnLogin = document.getElementById("btnLogin");
const btnLogout = document.getElementById("btnLogout");
const email = document.getElementById("email");
const senha = document.getElementById("senha");
const erro = document.getElementById("erro");
const loginScreen = document.getElementById("loginScreen");
const appScreen = document.getElementById("appScreen");

const nome = document.getElementById("nome");
const custo = document.getElementById("custo");
const preco = document.getElementById("preco");
const estoque = document.getElementById("estoque");
const addProduto = document.getElementById("addProduto");
const listaProdutos = document.getElementById("listaProdutos");

const produtosRef = collection(db, "produtos");

// ðŸ”¹ LOGIN
btnLogin.addEventListener("click", () => {
  console.log("BotÃ£o Entrar clicado");
  signInWithEmailAndPassword(auth, email.value, senha.value)
    .then(() => console.log("Login OK"))
    .catch(e => {
      console.error(e);
      erro.innerText = "Erro no login";
    });
});

// ðŸ”¹ LOGOUT
btnLogout.addEventListener("click", () => signOut(auth));

// ðŸ”¹ CONTROLE DE LOGIN
onAuthStateChanged(auth, user => {
  console.log("Auth mudou:", user);
  if (user) {
    loginScreen.classList.add("hidden");
    appScreen.classList.remove("hidden");
  } else {
    appScreen.classList.add("hidden");
    loginScreen.classList.remove("hidden");
  }
});

// ðŸ”¹ PRODUTOS
addProduto.addEventListener("click", async () => {
  await addDoc(produtosRef, {
    nome: nome.value,
    custo: Number(custo.value),
    preco: Number(preco.value),
    estoque: Number(estoque.value)
  });
  nome.value = custo.value = preco.value = estoque.value = "";
});

onSnapshot(produtosRef, snapshot => {
  listaProdutos.innerHTML = "";
  snapshot.forEach(doc => {
    const p = doc.data();
    listaProdutos.innerHTML += `
      <tr>
        <td>${p.nome}</td>
        <td>${p.preco}</td>
        <td>${p.estoque}</td>
      </tr>
    `;
  });
});
</script>
